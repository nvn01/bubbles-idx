generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Table Stocks
model Stock {
  id                 Int      @id @default(autoincrement())
  kode_emiten        String   @unique
  nama_emiten        String
  is_suspended       Boolean  @default(false)
  tanggal_pencatatan String?
  created_at         DateTime @default(now())

  // Relation to ticker
  tickers   Ticker[]
  notations Notation[]
  indices   StockIndex[]
  market_news MarketNews[]

  @@map("stocks")
}

model Notation {
  kode      String @id
  deskripsi String
  stocks    Stock[]

  @@map("notations")
}

model StockIndex {
  id        Int    @id
  kode      String @unique
  nama      String
  deskripsi String
  stocks    Stock[]

  @@map("stock_indices")
}


// Table Ticker (Price History & Performance)
model Ticker {
  stocks_id Int
  price     Float
  ts        DateTime
  
  // Performance Metrics (Percentage Changes)
  h Float? @default(0) // 1 Hour
  d Float? @default(0) // 1 Day
  w Float? @default(0) // 1 Week
  m Float? @default(0) // 1 Month
  y Float? @default(0) // 1 Year

  // Relation to Stock
  stock Stock @relation(fields: [stocks_id], references: [id], onDelete: Cascade)

  @@unique([stocks_id, ts]) // Composite Key
  @@index([ts])
  @@map("ticker")
}

// Table Market News
model MarketNews {
  id           Int      @id @default(autoincrement())
  title        String
  url          String   @unique
  source       String
  published_at DateTime
  image_url    String?
  
  // Optional relation to Stock
  stock_id     Int?
  stock        Stock?   @relation(fields: [stock_id], references: [id])
  
  created_at   DateTime @default(now())

  @@map("market_news")
}

// Table Top Brokerage (Broker Summary)
model BrokerSummary {
  id        Int      @id @default(autoincrement())
  date      DateTime @db.Date
  kode      String   // Broker Code
  nama      String   // Broker Name
  volume    BigInt
  value     BigInt
  frequency Int
  
  created_at DateTime @default(now())

  @@unique([date, kode])
  @@map("broker_summary")
}

// Table Corporate Calendar
model CorporateCalendar {
  id          Int      @id @default(autoincrement())
  date        DateTime @db.Date
  kode_emiten String   // Stock Code
  description String
  location    String?
  
  created_at  DateTime @default(now())

  @@map("corporate_calendar")
}
